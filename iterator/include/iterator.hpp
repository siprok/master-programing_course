/* Image iterator.
 * @file
 * @date 2018-08-05
 * @author Anonymous
 */

#ifndef __ITERATOR_HPP__
#define __ITERATOR_HPP__

#include <algorithm>
#include <type_traits>
#include <vector>
#include <utility>

#include <boost/iterator/iterator_adaptor.hpp>

//{ image iterator
mDC+H+a67nONcInQdwLikwtlAbfEbtg00wD2wUzL+yk=
k6ySjG50Ng5n41lXdWb7zLI1A/QiOABdXq+uTyDJGltULOtc0YfKMfVLUZh8qMXvotbKM4YVh2rdZ5nqbc/h0IGi8FIeik4yCjfmHZgx13hC5G16d64tHz2QlECtBotpOSi2PV+Zbmx9crxXhoNtHRAU6qOrTWkGMynNLF9uf1Ypqx8EUtuE8D2mNJiiE0ObQj9lP0LTu22+fAPlGXRXAg==
LgPVxAI5za4tL5IVWfsmtg==
UFXg5pYMSSjRxDK95dCX+g==
    qCUfiI+hFbnTBGB0DasJjYeW2BgddZk8rThaihZLZNfW1T72Qy0ELQmfpD/XqDi2OJpHl9GVA/Ko1ZwOvEz83Q==
        xlgnbQ/d3+zSA2Yl8+q4aVzv2O+4bh6zEfn2zDvkscBZpyzap2FGd1Rklk4h8SJX
        rkeEy8BiMibQIfiZvvPW8A==
        7zdB5Kiv0F13Cr99LsnpJA==
        QhfTve89Jxylyva8Ux/WWg==
    6E3mWdD53x/Z1xqLGpOCDg==

Gwsj/fhaItxdNEFbnj6Vbg==
    6PleNTzL8SVhrBgTRCvjnFaTodkyrSf8ycjDZM4GdM92OLP4XX7Yi8K/iHbU0FLn
    fwDgfmDLue0DYBsM2t45vnpY14Nf+hgBdnGQTHW6lfsasWhSiqlff/ajD2R9q76MJPckq2eJhYlpxL4r+gEJdA==

    iGm9JIN7P5y5BgvOyuETcRFhfQtsfvyTnrHvxCsYOrk=
    LgPVxAI5za4tL5IVWfsmtg==
        0yR3mhQhPGWBEongRPh0Pw==
    zUf8/u0/bakR1xEVdp3UYg==

    vioxtiRKuRya8UC7O0watDtBEFapIWdMC5R7fQINMGg=
    LgPVxAI5za4tL5IVWfsmtg==
        uZ4hksynrwgwbXbWltx7bg==
    zUf8/u0/bakR1xEVdp3UYg==

    ovvvlVs6FYKIJCP9jkyHsYWBvqd/dHAh4iYOw5/c674=
    LgPVxAI5za4tL5IVWfsmtg==
        a32CMFWlCs30EQchMzDyfjxXU/X5lE3fzYAkXxLSszbQpumY36bujSfzaEnA7DJhlkW0nsR2eXMdTmFvcwjHqw==
        6elzW1fRmKU/QL3/zzxURArhCPAbac8ptp3WAXrpGIDRNRTnCGMrHXBAmfQ6bZWNzmVs/QD2uYt62R+Xbx+bAJC9cml4z1fPQS3I+D0Ygb4=
        dA/8CkdFtSAoawMMOA7wSGbSF3X3U5hJNJ44z7fm7N8=
        WX787TOaTexkV57uTIdB8+ejKb2oSAhCZB0vgtBZyvqGfJmL0oW2TjYhSyxHbVwFU+UZ8ErepcMAvSFmYV4N2Q==
    zUf8/u0/bakR1xEVdp3UYg==

    YfhxOtZ56fr2xPZAWzXSxGIoSfTHKGIz0Ze8IslP9sCqUoU26JigIG/RP6tTZHfN7UxCbhCJounhTIraHeHqqw==
    LgPVxAI5za4tL5IVWfsmtg==
        altDTWrcL45VObR6ewtM4Nf5OXNF/WNo8k8de8fGQDnGUE0oLPCHx3HK9++U+OsYmQSgIUFcA4jTng/7o3Iic53LVjFjnWs809/7U7jvKaHxejDCEgUBiEZSnn0rOi0papbP8fYBy+U5OQpWgYSfQQ==
        sXPri24z92aJeFK/v2+jkfsq+m8AJEPK9Jj2FlsYr63T05E23xn+48j8PrVg71IyV7IelhM3aeoEW8Q8sunrNNPHwaLV3JPixeDuz+g1xC8JhAvg4L1C8PNs1xXjZgM1
    zUf8/u0/bakR1xEVdp3UYg==

    dRKQ6v9qkv3ar8UJ4lDfWg==
    xNG2yYU5fik4D3M884nz3w==
    5I0vQBY/EHs2c4gAwYVGpg==
PcLkR37CGC3Q8Cz1CpR1UA==
//}

template<class Container = std::vector<uint8_t>>
class image
{
public:
    image(size_t width, size_t height, size_t stride):
        data(stride * height),
        width_(width),
        stride_(stride)
    {}

    auto begin()
    {
        return image_iterator(data.begin(), width_, stride_);
    }

    auto end()
    {
        return image_iterator(data.end(), width_, stride_);
    }

    auto begin() const
    {
        return image_iterator(data.begin(), width_, stride_);
    }

    auto end() const
    {
        return image_iterator(data.end(), width_, stride_);
    }

private:
    Container data; // image data including strides. Access by (x, y): data[y * stride_ + x]
    size_t width_;
    size_t stride_;
};

#endif // __ITERATOR_HPP__
